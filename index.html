<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WimpyApp - Gestión de Pedidos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <?!= include('styles') ?> 
</head>
<body>
    <div class="app-container">
        <div id="homeScreen" class="screen active">
            <div class="home-container">
                <div class="home-header">
                    <div class="logo-large">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <h1>WimpyApp</h1>
                    <p>Gestión de Pedidos y Fidelización</p>
                </div>
                <div class="home-buttons">
                    <button class="btn btn-home btn-clients" onclick="goToClientLogin()">
                        <i class="fas fa-users"></i>
                        <span>Clientes</span>
                    </button>
                    <button class="btn btn-home btn-admin" onclick="goToAdminLogin()">
                        <i class="fas fa-lock"></i>
                        <span>Administrador</span>
                    </button>
                </div>
                <div class="home-footer">
                    <p>© 2025 WimpyApp. Todos los derechos reservados.</p>
                </div>
            </div>
        </div>
        <div id="clientLoginScreen" class="screen">
            <div class="client-login-container">
                <div class="header">
                    <button class="back-btn" onclick="goHome()">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2>Acceso Clientes</h2>
                </div>
                <form id="clientLoginForm" onsubmit="handleClientLogin(event)">
                    <div id="clientLoginStep1">
                        <p>Ingresa tu número de teléfono para empezar.</p>
                        <div class="form-group">
                            <label for="clientPhone">Teléfono</label>
                            <input type="tel" id="clientPhone" placeholder="3001234567" required>
                        </div>
                        <button class="btn btn-primary btn-full-width" type="submit">
                            <i class="fas fa-arrow-right"></i> Continuar
                        </button>
                    </div>
                    <div id="clientLoginStep2" style="display: none;">
                        <p id="clientLoginMessage"></p>
                        <div class="form-group password-group">
                            <label for="clientPassword">Contraseña</label>
                            <input type="password" id="clientPassword" placeholder="********" required>
                            <button type="button" class="forgot-password" onclick="handleForgotPassword()">
                                ¿Olvidaste la contraseña?
                            </button>
                        </div>
                        <button class="btn btn-primary btn-full-width" type="submit">
                            <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                        </button>
                    </div>
                    <div id="clientLoginStep3" style="display: none;">
                        <p>Verificación de PIN enviada a tu email.</p>
                        <div class="form-group">
                            <label for="clientPin">PIN</label>
                            <input type="number" id="clientPin" placeholder="XXXXXX" required>
                        </div>
                        <button class="btn btn-primary btn-full-width" onclick="handleVerifyPin(event)">
                            <i class="fas fa-check"></i> Verificar PIN
                        </button>
                        <button type="button" class="btn btn-link mt-16" onclick="resendPin()">
                            Reenviar PIN
                        </button>
                    </div>
                    <div id="clientLoginStep4" style="display: none;">
                        <p>Establece una nueva contraseña.</p>
                        <div class="form-group">
                            <label for="newClientPassword">Nueva Contraseña</label>
                            <input type="password" id="newClientPassword" placeholder="********" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmClientPassword">Confirmar Contraseña</label>
                            <input type="password" id="confirmClientPassword" placeholder="********" required>
                        </div>
                        <button class="btn btn-primary btn-full-width" onclick="handleCreatePassword(event)">
                            <i class="fas fa-lock"></i> Establecer Contraseña
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div id="adminLoginScreen" class="screen">
            <div class="admin-login-container">
                <div class="header">
                    <button class="back-btn" onclick="goHome()">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2>Acceso Administrador</h2>
                </div>
                <form onsubmit="handleAdminLogin(event)">
                    <p>Ingresa la contraseña de administrador.</p>
                    <div class="form-group">
                        <label for="adminPassword">Contraseña</label>
                        <input type="password" id="adminPassword" placeholder="********" required>
                    </div>
                    <button class="btn btn-primary btn-full-width" type="submit">
                        <i class="fas fa-lock-open"></i> Iniciar Sesión
                    </button>
                </form>
            </div>
        </div>

        <div id="clientDashboardScreen" class="screen">
            <div class="dashboard-header">
                <div class="welcome-message">
                    <p>Bienvenido,</p>
                    <h2 id="clientNameDisplay">Cliente</h2>
                </div>
                <div class="client-actions">
                    <button class="btn btn-danger btn-sm" onclick="handleClientLogout()">
                        <i class="fas fa-sign-out-alt"></i> Salir
                    </button>
                </div>
            </div>

            <div class="dashboard-tabs">
                <button class="tab-btn active" data-tab="clientProducts" onclick="switchClientTab('clientProducts')">
                    <i class="fas fa-coffee"></i> Productos
                </button>
                <button class="tab-btn" data-tab="clientOrders" onclick="switchClientTab('clientOrders')">
                    <i class="fas fa-receipt"></i> Pedidos
                </button>
                <button class="tab-btn" data-tab="clientPoints" onclick="switchClientTab('clientPoints')">
                    <i class="fas fa-star"></i> Puntos
                </button>
            </div>

            <div id="clientDashboardContent">
                <div id="clientProducts" class="tab-content active">
                    <div class="section-header">
                        <h3>Menú</h3>
                        <div class="search-box">
                            <input type="text" id="productSearch" placeholder="Buscar producto..." onkeyup="handleSearch(this.value, 'products')">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                    <div id="productsGrid" class="products-grid">
                        <p class="text-secondary">Cargando productos...</p>
                    </div>
                </div>

                <div id="clientOrders" class="tab-content">
                    <div class="section-header">
                        <h3>Mi Historial de Pedidos</h3>
                    </div>
                    <div id="ordersList" class="data-list">
                        <p class="text-secondary">Cargando pedidos...</p>
                    </div>
                </div>

                <div id="clientPoints" class="tab-content">
                    <div class="section-header">
                        <h3>Programa de Puntos</h3>
                    </div>
                    <div class="points-card">
                        <p>Total de Puntos Acumulados</p>
                        <div class="points-display">
                            <i class="fas fa-star"></i>
                            <span id="currentPointsDisplay">0</span>
                        </div>
                        <p class="text-secondary">Cada punto equivale a <span id="pointsRateDisplay">1</span> COP de descuento.</p>
                    </div>

                    <h4 class="mt-16">Historial de Transacciones</h4>
                    <div id="pointsHistory" class="data-list">
                        <p class="text-secondary">Cargando historial...</p>
                    </div>
                </div>
            </div>

            <div id="cartWidget" class="cart-widget">
                <div class="cart-header" onclick="toggleCart()">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Ver Carrito (<span id="cartCount">0</span>)</span>
                    <span id="cartTotalDisplay" class="cart-total-price">$0</span>
                </div>
                <div id="cartDetails" class="cart-details-container">
                    <div id="cartItemsList" class="cart-items-list">
                        <p class="text-secondary text-center">El carrito está vacío.</p>
                    </div>
                    <div class="cart-footer">
                        <button class="btn btn-primary btn-full-width" onclick="openOrderConfirmModal()">
                            <i class="fas fa-check-circle"></i> Confirmar Pedido
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="adminDashboardScreen" class="screen">
            <div class="dashboard-header">
                <div class="welcome-message">
                    <p>Panel de Control</p>
                    <h2>Administrador</h2>
                </div>
                <div class="admin-actions">
                    <button class="btn btn-danger btn-sm" onclick="handleAdminLogout()">
                        <i class="fas fa-sign-out-alt"></i> Salir
                    </button>
                </div>
            </div>

            <div class="dashboard-tabs">
                <button class="tab-btn active" data-tab="adminOrders" onclick="switchAdminTab('adminOrders')">
                    <i class="fas fa-receipt"></i> Pedidos
                </button>
                <button class="tab-btn" data-tab="adminProducts" onclick="switchAdminTab('adminProducts')">
                    <i class="fas fa-box"></i> Productos
                </button>
                <button class="tab-btn" data-tab="adminClients" onclick="switchAdminTab('adminClients')">
                    <i class="fas fa-users"></i> Clientes
                </button>
                <button class="tab-btn" data-tab="adminEnterprises" onclick="switchAdminTab('adminEnterprises')">
                    <i class="fas fa-building"></i> Empresas
                </button>
                <button class="tab-btn" data-tab="adminConfig" onclick="switchAdminTab('adminConfig')">
                    <i class="fas fa-cog"></i> Configuración
                </button>
            </div>

            <div id="adminDashboardContent">
                
                <div id="adminOrders" class="tab-content active">
                    <div class="section-header">
                        <h3>Pedidos Pendientes</h3>
                        <div class="search-box">
                            <input type="text" id="adminOrderSearch" placeholder="Buscar pedido o cliente..." onkeyup="handleSearch(this.value, 'adminOrders')">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                    <div id="adminOrdersList" class="data-list">
                        <p class="text-secondary">Cargando pedidos...</p>
                    </div>
                </div>

                <div id="adminProducts" class="tab-content">
                    <div class="section-header">
                        <h3>Gestión de Productos</h3>
                        <button class="btn btn-primary btn-sm" onclick="openCreateProductModal()">
                            <i class="fas fa-plus"></i> Nuevo Producto
                        </button>
                    </div>
                    <div id="adminProductsGrid" class="data-grid-list">
                        <p class="text-secondary">Cargando productos...</p>
                    </div>
                </div>

                <div id="adminClients" class="tab-content">
                    <div class="section-header">
                        <h3>Gestión de Clientes</h3>
                        <button class="btn btn-primary btn-sm" onclick="openCreateClientModal()">
                            <i class="fas fa-user-plus"></i> Nuevo Cliente
                        </button>
                    </div>
                    <div id="adminClientsList" class="data-grid-list">
                        <p class="text-secondary">Cargando clientes...</p>
                    </div>
                </div>

                <div id="adminEnterprises" class="tab-content">
                    <div class="section-header">
                        <h3>Gestión de Empresas</h3>
                        <button class="btn btn-primary btn-sm" onclick="openCreateEnterpriseModal()">
                            <i class="fas fa-city"></i> Nueva Empresa
                        </button>
                    </div>
                    <div id="adminEnterprisesList" class="data-grid-list">
                        <p class="text-secondary">Cargando empresas...</p>
                    </div>
                </div>

                <div id="adminConfig" class="tab-content">
                    <div class="section-header">
                        <h3>Configuración del Sistema</h3>
                        <button class="btn btn-success btn-sm" onclick="handleUpdateConfiguration()">
                            <i class="fas fa-sync-alt"></i> Guardar Cambios
                        </button>
                    </div>
                    <form id="configurationForm" class="form-container">
                        <p class="text-secondary">Cargando configuración...</p>
                    </form>
                </div>
            </div>
        </div>

        <div id="orderConfirmModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Confirmar Pedido</h3>
                    <button class="close-btn" onclick="closeModal('orderConfirmModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <h4 class="text-center mb-16">Total: <span id="finalOrderTotalDisplay">$0</span></h4>
                    <form id="orderConfirmForm">
                        <div class="form-group">
                            <label for="orderNotes">Notas del pedido (opcional)</label>
                            <textarea id="orderNotes" placeholder="Ej: Sin cebolla, entrega en portería..."></textarea>
                        </div>
                        <div class="form-group points-group">
                            <label>Puntos a Canjear (Tienes <span id="availablePoints">0</span>)</label>
                            <input type="number" id="pointsToUse" min="0" value="0" oninput="calculatePointsDiscount()">
                            <p class="text-secondary">Descuento aplicado: $<span id="pointsDiscountDisplay">0</span></p>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('orderConfirmModal')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button class="btn btn-primary" onclick="handleOrderSubmit()">
                        <i class="fas fa-paper-plane"></i> Enviar Pedido
                    </button>
                </div>
            </div>
        </div>

        <div id="createClientModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Crear Nuevo Cliente</h3>
                    <button class="close-btn" onclick="closeModal('createClientModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="createClientForm">
                        <div class="form-group">
                            <label>Teléfono</label>
                            <input type="tel" id="newClientPhone" placeholder="3001234567" required>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="newClientEmail" placeholder="cliente@example.com" required>
                        </div>
                        <div class="form-group">
                            <label>Empresa (ID)</label>
                            <select id="newClientEnterpriseId" required>
                                </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('createClientModal')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button class="btn btn-primary" onclick="submitCreateClient()">
                        <i class="fas fa-user-plus"></i> Crear Cliente
                    </button>
                </div>
            </div>
        </div>

        <div id="createProductModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Crear Nuevo Producto</h3>
                    <button class="close-btn" onclick="closeModal('createProductModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="createProductForm">
                        <div class="form-group">
                            <label>Nombre</label>
                            <input type="text" id="newProductName" placeholder="Ej: Café Americano" required>
                        </div>
                        <div class="form-group">
                            <label>Precio</label>
                            <input type="number" id="newProductPrice" placeholder="10000" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Categoría</label>
                            <input type="text" id="newProductCategory" placeholder="Ej: Bebidas" required>
                        </div>
                        <div class="form-group">
                            <label>Emoji</label>
                            <input type="text" id="newProductEmoji" placeholder="☕" maxlength="5" required>
                        </div>
                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="newProductDaPuntos">
                            <label for="newProductDaPuntos">Este producto otorga puntos</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('createProductModal')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button class="btn btn-primary" onclick="submitCreateProduct()">
                        <i class="fas fa-save"></i> Crear Producto
                    </button>
                </div>
            </div>
        </div>
        
        <div id="createEnterpriseModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Crear Nueva Empresa</h3>
                    <button class="close-btn" onclick="closeModal('createEnterpriseModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="createEnterpriseForm">
                        <div class="form-group">
                            <label>Nombre</label>
                            <input type="text" id="newEnterpriseName" placeholder="Ej: Google Colombia" required>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="newEnterpriseEmail" placeholder="empresa@example.com" required>
                        </div>
                        <div class="form-group">
                            <label>Teléfono</label>
                            <input type="tel" id="newEnterprisePhone" placeholder="3001234567" required>
                        </div>
                        <div class="form-group">
                            <label>Dirección</label>
                            <input type="text" id="newEnterpriseAddress" placeholder="Calle 1 # 1-1" required>
                        </div>
                        <div class="form-group">
                            <label>NIT</label>
                            <input type="text" id="newEnterpriseNIT" placeholder="123456789" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('createEnterpriseModal')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button class="btn btn-primary" onclick="submitCreateEnterprise()">
                        <i class="fas fa-save"></i> Crear Empresa
                    </button>
                </div>
            </div>
        </div>
        <div id="notificationContainer" class="notification-container"></div>
    </div>
    <?!= include('app') ?> 
</body>
</html>
